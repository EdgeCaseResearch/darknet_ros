language: generic

sudo: required

cache:
  directories:
    - darknet_ros/yolo_network_config/weights

services:
  - docker

env:
  global:
    secure: ly6e+R0j2ZLwDSwGUqT1XQ3FYYekib7EJhEg9wZ/GgjDVkdRMdhGBesN6+jq45LI3e6Y3nivXrlaCmSIKZxybdOEUomrVSUKgMELoLktb9AWRXRuXEgD3eeV3zkNrBfYbVQyRW+j0qB2iRu3fKVMlOb9c0b2tra22Wd0spgJAB1HMmltT3DH7yRrMYfqGsyz2NgDUjmli53X4HiZTUCCLqFTFSHJlwhyh4xxqQ2U/2Z/aHLwovjnVwe4VSQ/LPnT67nXvVbC6CVOHvD5JNsywMt3jh80UsF8oJUy9Aip1vrDYpcpSQFCC4y1AML6O7yz9b2/H8ToOM6mlch2Caa5P+T6uq/NjIuinZARLSOdHy83BuF/7bnVBd+5qmlBhQDCCqpVzbwrDpxwEc7i8DDQUZ394uTxkMcspHl+VrVTQg3Tv9KR4YfOykyZjVBWwyyMKdXrTw/oAol34EpeAqoJAJelHTxKmQc7mT4Vx5seJbRl/ekqHNiJa+grb4HGwXoLsicTooD4g7turFnYlouh4ew0SHGOeibR1j8fgkcVsYFVq/RLxYfJmrykLq48m1oN7k99PgXxbbRJV+uw5lHDoar7yNAecsWXDqx6rBY/aoUuwtQ/hq55gy10Pwcw9bPzcmNV28PLGlY37e7pMZ+fvD5Q+4KfhKX4fgAONUjZXNI=
  matrix:
    - TARGET=cpu COMPUTE=-1
    - TARGET=gpu COMPUTE=61
    - TARGET=gpu COMPUTE=52
    - TARGET=gpu COMPUTE=37

before_install:
  - echo "Branch is $TRAVIS_BRANCH"
  - sudo apt-get -qq update
  - sudo apt-get -q install -y python-pip wget
  - sudo pip -q install awscli

script:

  - set -e
  - bash build_image.sh ${TARGET} ${COMPUTE}

deploy:
  provider: script
  script: bash push_image.sh ${TARGET} ${COMPUTE}
  on:
    branch: master
